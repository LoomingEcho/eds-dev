{"version":3,"file":"posts.js","sources":["../../src/blocks/posts/posts.ts"],"sourcesContent":["import { html, render } from 'lit';\nimport { createOptimizedPicture } from '../../utils/createOptimizedPicture';\nimport { fetchText } from '../../utils/fetch.ts';\nimport { SheetService } from '../../services/sheet.service.ts';\n\ninterface PostArgs {\n  postUrl: string;\n  headline?: string;\n  text?: string;\n  picture: HTMLPictureElement;\n}\n\nconst postTemplate = (args: PostArgs) => {\n  const { postUrl, headline, text, picture } = args;\n  return html`\n    <article>\n      <a href=\"${postUrl}\" class=\"image\">${picture}</a>\n      <h3>${headline}</h3>\n      <p>${text?.slice(0, 200)}</p>\n      <ul class=\"actions\">\n        <li><a href=\"${postUrl}\" class=\"button\">More</a></li>\n      </ul>\n    </article>\n  `;\n};\n\nconst template = (posts: PostArgs[]) => {\n  return posts.map((post) => postTemplate(post));\n};\n\nexport default async function (block: HTMLElement) {\n  block.innerHTML = '';\n\n  const sheetService = new SheetService();\n  const parser = new DOMParser();\n\n  const siteMap = await sheetService.getSiteMap();\n  const siteMapPostEntries = siteMap.filter((item) => item.path.includes('/posts'));\n\n  const postsPreview = await Promise.all(\n    siteMapPostEntries.map(async (post) => await fetchText(`${post.path}.plain.html`))\n  );\n\n  const postsPreviewHtml = postsPreview.map((res) => parser.parseFromString(res, 'text/html'));\n\n  const posts = postsPreviewHtml.map((doc, index) => {\n    return {\n      postUrl: `${window.hlx.codeBasePath}${siteMapPostEntries[index].path}`,\n      headline: doc.querySelector('h1')?.innerText || doc.querySelector('h2')?.innerText,\n      text: doc.querySelector('p')?.innerText?.trim(),\n      picture: createOptimizedPicture({\n        src: siteMapPostEntries[index].image,\n        alt: siteMapPostEntries[index].imagealt,\n      }),\n    };\n  });\n\n  block.style.removeProperty('display');\n  render(template(posts), block);\n}\n"],"names":["postTemplate","args","postUrl","headline","text","picture","html","template","posts","post","block","sheetService","SheetService","parser","siteMapPostEntries","item","fetchText","res","doc","index","_a","_b","_d","_c","createOptimizedPicture","render"],"mappings":"oJAYA,MAAMA,EAAgBC,GAAmB,CACvC,KAAM,CAAE,QAAAC,EAAS,SAAAC,EAAU,KAAAC,EAAM,QAAAC,GAAYJ,EACtC,OAAAK,sBAEQJ,CAAO,mBAAmBG,CAAO,WACtCF,CAAQ,WACTC,GAAA,YAAAA,EAAM,MAAM,EAAG,IAAI,wCAEPF,CAAO,+CAI9B,EAEMK,EAAYC,GACTA,EAAM,IAAKC,GAAST,EAAaS,CAAI,CAAC,EAG/C,eAAAD,EAA+BE,EAAoB,CACjDA,EAAM,UAAY,GAEZ,MAAAC,EAAe,IAAIC,EACnBC,EAAS,IAAI,UAGbC,GADU,MAAMH,EAAa,cACA,OAAQI,GAASA,EAAK,KAAK,SAAS,QAAQ,CAAC,EAQ1EP,GANe,MAAM,QAAQ,IACjCM,EAAmB,IAAI,MAAOL,GAAS,MAAMO,EAAU,GAAGP,EAAK,IAAI,aAAa,CAAC,CAAA,GAG7C,IAAKQ,GAAQJ,EAAO,gBAAgBI,EAAK,WAAW,CAAC,EAE5D,IAAI,CAACC,EAAKC,IAAU,aAC1C,MAAA,CACL,QAAS,GAAG,OAAO,IAAI,YAAY,GAAGL,EAAmBK,CAAK,EAAE,IAAI,GACpE,WAAUC,EAAAF,EAAI,cAAc,IAAI,IAAtB,YAAAE,EAAyB,cAAaC,EAAAH,EAAI,cAAc,IAAI,IAAtB,YAAAG,EAAyB,WACzE,MAAMC,GAAAC,EAAAL,EAAI,cAAc,GAAG,IAArB,YAAAK,EAAwB,YAAxB,YAAAD,EAAmC,OACzC,QAASE,EAAuB,CAC9B,IAAKV,EAAmBK,CAAK,EAAE,MAC/B,IAAKL,EAAmBK,CAAK,EAAE,QAAA,CAChC,CAAA,CACH,CACD,EAEKT,EAAA,MAAM,eAAe,SAAS,EAC7Be,EAAAlB,EAASC,CAAK,EAAGE,CAAK,CAC/B"}